<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Productos_m extends CI_Model {
  public function __construct(){parent::__construct();   
   }     
	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
public function insert2($data,$base)
{
	$this->db->insert($base, $data);                
		if ($this->db->affected_rows()>=1){
      return "SI"; 
      }
      else {
      return "NO"; 
      }   
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	 
public function update($id,$data,$base)
{
	$this->db->where('idUSUARIO', $id);
   $this->db->update($base, $data);
		if ($this->db->affected_rows()>=1){
         return "SI"; 
      }
      else {
         return "NO"; 
      }   
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function insert($data,$base){
	$db_debug = $this->db->db_debug; //save setting
   $this->db->db_debug = FALSE; //disable debugging for queries
	$datos=$this->db->insert($base, $data); 		 
		if ($this->db->affected_rows()>=1){			
         return $this->db->insert_id(); 
      }else {
         return false;  
      }			
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////		
function getCursos()
{
    $sql = "SELECT * FROM cursos WHERE activo=1";
    $consulta = $this->db->query($sql); 
    return $consulta;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function getCursoById($idCurso)
{
    $sql = "SELECT * FROM cursos WHERE idCurso = $idCurso AND activo=1";
    $consulta = $this->db->query($sql); 
    return $consulta;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function getClienteByEmail($email)
{
    $email = $this->db->escape($email);
    $sql = "SELECT * FROM clientes WHERE email = $email";
    $consulta = $this->db->query($sql); 
    return $consulta;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function getComprasCliente($idCliente)
{
    $sql = "SELECT c.idCompra, c.fecha_compra, cu.idCurso, cu.nombre, cu.descripcion, cu.precio, cu.imagen 
            FROM compras c 
            JOIN cursos cu ON c.idCurso = cu.idCurso 
            WHERE c.idCliente = $idCliente 
            ORDER BY c.fecha_compra DESC";
    $consulta = $this->db->query($sql); 
    return $consulta;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function getEstadisticasCompras()
{
    $sql = "SELECT cu.idCurso, cu.nombre, COUNT(c.idCompra) as total_compras, 
            SUM(cu.precio) as total_ingresos 
            FROM cursos cu 
            LEFT JOIN compras c ON cu.idCurso = c.idCurso 
            GROUP BY cu.idCurso 
            ORDER BY total_compras DESC";
    $consulta = $this->db->query($sql); 
    return $consulta;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////		
	
	 
	}
?>